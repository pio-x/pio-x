<!DOCTYPE HTML>

<html ng-app="backendApp">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>PIO-X Backend</title>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="css/style.css">
	<script src="js/map.js"></script>
</head>

<body>
	<div ng-controller="mainCtrl" ng-cloak>
		<header>
			<div class="well well-lg">PIO-X Admin</div>
			<button ng-click="logout()" ng-if="loggedIn" class="btn btn-default">Logout</button>
		</header>
		<div class="content" ng-if="loggedIn == false && showLogin == true">
				<input type="text" ng-model="hash" ng-keyup="$event.keyCode == 13 && login(hash)"/>
				<button ng-click="login(hash)" class="btn btn-default">Login</button>
		</div>
		<div class="content" ng-if="loggedIn == true">
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active"><a href="#karte" aria-controls="karte" role="tab" data-toggle="tab">Karte</a></li>
				<li role="presentation"><a href="#teams" aria-controls="teams" role="tab" data-toggle="tab">Teams</a></li>
				<li role="presentation"><a href="#stationen "aria-controls="stationen" role="tab" data-toggle="tab">Stationen</a></li>
				<li role="presentation"><a href="#bilder" aria-controls="bilder" role="tab" data-toggle="tab">Bilder</a></li>
				<li role="presentation"><a href="#notifications" aria-controls="notifications" role="tab" data-toggle="tab">Notifications</a></li>
				<li role="presentation"><a href="#passcodes" aria-controls="passcodes" role="tab" data-toggle="tab">Passcodes</a></li>
				<li role="presentation"><a href="#raetsel" aria-controls="raetsel" role="tab" data-toggle="tab">Rätsel</a></li>
				<li role="presentation"><a href="#qrcodes" aria-controls="qrcodes" role="tab" data-toggle="tab">QR codes</a></li>
			</ul>
			<div class="tab-content actual-content">
				<!-- MAP -->
				<div role="tabpanel" class="tab-pane active" id="karte" ng-controller="mapCtrl">
					<div id="map"></div>
					<div class="submenu" ng-repeat="group in groups">
						<div class="btn btn-default" ng-click="showTeamOnMap(group.t_ID)">{{ group.name }}</div>
					</div>
					<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjEW54VdlWZT07n90oTjvaLIl3q27ZL4Y&callback=initMap" async defer></script>
				</div>
				<!-- TEAMS -->
				<div role="tabpanel" class="tab-pane" id="teams" ng-controller="teamCtrl">
					<table id="teamliste" class="table table-striped">
						<tr>
								<td>ID</td>
								<td>Name</td>
								<td>Score</td>
								<td>Hash</td>
								<td>Farbe</td>
								<td></td>
								<td></td>
						</tr>
						<tr ng-repeat="group in groups">
								<td>{{ group.t_ID }}</td>
								<td><input type="text" class="form-control" value="{{ group.name }}" /></td>
								<td><input type="text" class="form-control" value="{{ group.score }}" /></td>
								<td><input type="text" class="form-control" value="{{ group.hash }}" /></td>
								<td style="background: {{ group.color }}"><input type="color" placeholder="Teamfarbe" value="{{ group.color }}" /></td>
								<td><button ng-click="updateTeam(group)" class="btn btn-default">&#128190;</button></td>
								<td><button ng-click="deleteTeam(group.t_ID)" class="btn btn-default">&#9003;</button></td>
						</tr>
						<tr>
							<td>NEU</td>
							<td><input type="text" class="form-control" ng-model="newTeam.name"/></td>
							<td><input type="text" class="form-control" ng-model="newTeam.score"/></td>
							<td><input type="text" class="form-control" ng-model="newTeam.hash"/></td>
							<td><input type="color" placeholder="Teamfarbe"  ng-model="newTeam.color"/></td>
							<td colspan="2"><button ng-click="addNewTeam()" class="btn btn-default" ng-if="newTeam.name">&#128190;</button></td>
						</tr>
					</table>
				</div>
				<!-- STATIONS -->
				<div role="tabpanel" class="tab-pane" id="stationen" ng-controller="stationCtrl">
					<table id="stationenliste" class="table table-striped">
						<tr>
								<td>ID</td>
								<td>Name</td>
								<td>Beschreibung</td>
								<td>Letzte Einnahme</td>
								<td>Team Besitz</td>
								<td>Team Farbe</td>
								<td></td>
								<td></td>
						</tr>
						<tr ng-repeat="station in stations">
								<td>{{ station.s_ID }}</td>
								<td><input type="text" class="form-control" value="{{ station.name }}" /></td>
								<td><input type="text" class="form-control" value="{{ station.description }}" /></td>
								<td><input type="text" class="form-control" value="{{ station.captured_timestamp | date: 'HH:mm dd.MM.yyyy' }}" /></td>
								<td><input type="text" class="form-control" value="{{ station.team }}" /></td>
								<td style="background: {{ station.color }}"><input type="color" placeholder="Stationsfarbe" value="{{ group.color }}" /></td>
								<td><button ng-click="updateTeam(group)" class="btn btn-default">&#128190;</button></td>
								<td><button ng-click="deleteTeam(group.t_ID)" class="btn btn-default">&#9003;</button></td>
						</tr>
						<tr>
							<td>NEU</td>
							<td><input type="text" class="form-control" ng-model="newStation.name"/></td>
							<td><input type="text" class="form-control" ng-model="newStation.score"/></td>
							<td><input type="text" class="form-control" ng-model="newStation.hash"/></td>
							<td><input type="color" placeholder="Stationsfarbe"  ng-model="newStation.color"/></td>
							<td colspan="2"><button ng-click="addNewStiation()" class="btn btn-default" ng-if="newStation.name">&#128190;</button></td>
						</tr>
					</table>
				</div>
				<!-- IMAGES -->
				<div role="tabpanel" class="tab-pane" id="bilder">Bilder auflisten</div>
				<!-- NOTIFICATIONS -->
				<div role="tabpanel" class="tab-pane" id="notifications" ng-controller="notificationCtrl">
					<div id="notificationlist">
						<table class="table table-striped">
							<tr>
								<td>ID</td>
								<td>Titel</td>
								<td>Nachricht</td>
								<td>Zeit</td>
								<td>Team ID</td>
							</tr>
							<tr ng-repeat="msg in notifications">
								<td>{{ msg.n_ID }}</td>
								<td>{{ msg.title }}</td>
								<td>{{ msg.text }}</td>
								<td>{{ msg.timestamp | date: 'yyyy' }}</td>
								<td>{{ msg.t_ID }}</td>
							</tr>
						</table>
					</div>
				</div>
				<!-- PASSCODES -->
				<div role="tabpanel" class="tab-pane" id="passcodes" ng-controller="passcodeCtrl">
					<div id="passcodelist">
						<table class="table table-striped">
							<tr>
								<td>ID</td>
								<td>Passcode</td>
								<td>Punkte</td>
								<td>Gebraucht</td>
								<td>Mr ?</td>
								<td></td>
								<td></td>
							</tr>
							<tr ng-repeat="code in passcodes">
								<td><input type="text" class="form-control"/ value="{{ code.p_ID }}"></td>
								<td><input type="text" class="form-control"/ value="{{ code.code }}"></td>
								<td><input type="text" class="form-control"/ value="{{ code.points }}"></td>
								<td><input type="text" class="form-control"/ value="{{ code.used }}"></td>
								<td><input type="text" class="form-control"/ value="{{ code.mrx_ID }}"></td>
								<td><button ng-click="updateCode(code)" class="btn btn-default">&#128190;</button></td>
								<td><button ng-click="deleteCode(code.p_ID)" class="btn btn-default">&#9003;</button></td>
							</tr>
							<tr >
								<td>NEU</td>
								<td><input type="text" ng-model="newCode.code" class="form-control"/></td>
								<td><input type="text" ng-model="newCode.points" class="form-control"/></td>
								<td><input type="text" ng-model="newCode.used" class="form-control"/></td>
								<td><input type="text" ng-model="newCode.mrx_ID" class="form-control"/></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td colspan="5">
									<button ng-click="addNewCode()" class="btn btn-default">Neuen Passcode hinzufügen</button>
								</td>
							</tr>
						</table>
					</div>
				</div>
				<!-- RIDDLES -->
				<div role="tabpanel" class="tab-pane" id="raetsel" ng-controller="riddleCtrl">
					<div id="riddlelist">
						<table class="table table-striped">
							<tr>
								<td>ID</td>
								<td>Latitude</td>
								<td>Longitude</td>
								<td>Frage</td>
								<td>Abhängigkeit</td>
								<td>Antwort</td>
								<td>Typ</td>
								<td>Punkte</td>
								<td></td>
								<td></td>
							</tr>
							<tr ng-repeat="riddle in riddles">
								<td>{{ riddle.r_ID }}</td>
								<td>{{ riddle.pos_lat }}</td>
								<td>{{ riddle.pos_long }}</td>
								<td>{{ riddle.question }}</td>
								<td>{{ riddle.dep_ID }}</td>
								<td>{{ riddle.answer }}</td>
								<td>{{ riddle.type }}</td>
								<td>{{ riddle.points }}</td>
								<td><button ng-click="updateRiddle(riddle.r_ID)" class="btn btn-default">&#128190;</button></td>
								<td><button ng-click="deleteRiddle(riddle.r_ID)" class="btn btn-default">&#9003;</button></td>
							</tr>
							<tr >
								<td>NEU</td>
								<td><input type="text" ng-model="newRiddle.pos_lat" class="form-control"/></td>
								<td><input type="text" ng-model="newRiddle.pos_long" class="form-control"/></td>
								<td><input type="text" ng-model="newRiddle.question" class="form-control"/></td>
								<td><input type="text" ng-model="newRiddle.dep_ID" class="form-control"/></td>
								<td><input type="text" ng-model="newRiddle.answer" class="form-control"/></td>
								<td><select ng-model="newRiddle.type" class="form-control">
										<option>MULTI</option>
										<option>SINGLE</option>
									</select>
								</td>
								<td><input type="text" ng-model="newRiddle.points" class="form-control"/></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td colspan="9">
									<button ng-click="addNewRiddle()" class="btn btn-default">Neues Rätsel hinzufügen</button>
								</td>
							</tr>
						</table>
					</div>
				</div>
				<!-- QR CODES -->
				<div role="tabpanel" class="tab-pane" id="qrcodes" ng-controller="QRCtrl">
					<h1>QR codes</h1>
					<p>Welchen Code möchtest du anzeigen?
					<input type="text" ng-model="search" class="form-control"></p>
					<table><tr>
						<td>
							<h3>{{search ? 'Gefilterte' : 'Alle'}} QR Codes</h3>
							<table class="table table-striped">
								<tr>
									<td>ID</td>
									<td>Team</td>
									<td>Hash</td>
									<td></td>
									<td rowspan="{{ groups.length + mrxs.length }}">
										<p>QR Code<span ng-if="qrUrl.team"> von {{ qrUrl.team }}</span></p>
										<div ng-if="qrUrl.team">
											<a href="{{ qrUrl.link }}">{{ qrUrl.link }}</a> <br/>
											<qrcode version="4" error-correction-level="M" size="200" data="{{ qrUrl.link }}" href="{{ qrUrl.link }}"></qrcode>
										</div>
									</td>
								</tr>
								<tr ng-repeat="group in groups | filter:search">
									<td>{{ group.t_ID }}</td>
									<td>{{ group.name }}</td>
									<td>{{ group.hash }}</td>
									<td>
										<a href="#" ng-click="showQR(group.t_ID, group.name, group.hash, 'team')">QR Code</a>
									</td>
								</tr>
								<tr ng-repeat="mrx in mrxs | filter:search">
									<td>{{ mrx.x_ID }}</td>
									<td>{{ mrx.name }}</td>
									<td>{{ mrx.x_hash }}</td>
									<td>
										<a href="#" ng-click="showQR(mrx.x_ID, mrx.name, mrx.x_hash, 'mrx')">QR Code</a>
									</td>
								</tr>
							</table>
						</td></tr>
					</table>
				</div>
			</div>
		</div>


		<footer>
			<p>Mit Herzblut programmiert von Fäger, Giga, Folleta, Chäfer und Punkt</p>
		</footer>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
	<script src="js/app.js"></script>
	<script src="js/services/apiService.js"></script>
	<script src="js/vendor/qrcode.js"></script>
	<script src="js/vendor/angular-qrcode.js"></script>
</body>

</html>