<ion-header>
  <ion-navbar>
    <ion-title>Map</ion-title>
    <ion-buttons end>
      <button ion-button icon-only (click)="updateMap()">
        <ion-icon name="refresh"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <sebm-google-map
          [latitude]="default_lat"
          [longitude]="default_lng"
          [zoom]="default_zoom"
          [streetViewControl]="false"
          [mapTypeControl]="true"
  >

    <!-- Station Radius -->
    <sebm-google-map-circle
            *ngFor="let station of stations"
            [latitude]="station.pos_lat"
            [longitude]="station.pos_long"
            [radius]="100"
            [fillColor]="station.color"
            [fillOpacity]="0.1"
            [circleDraggable]="false"
            [editable]="false"
            [clickable]="false"
    >
    </sebm-google-map-circle>

    <!-- Station Icons -->
    <sebm-google-map-marker
            *ngFor="let station of stations"
            [latitude]="station.pos_lat"
            [longitude]="station.pos_long"
            [iconUrl]="{
                path: 0,
                fillColor: station.color,
                fillOpacity: (station.team == myTeam ? 1 : 0),
                strokeColor: (station.team == myTeam ? 'white' : station.color),
                strokeWeight: 3,
                scale: 8
            }"
    >
      <sebm-google-map-info-window [disableAutoPan]="true">
        <h3>{{station.name}}</h3>
        <div *ngIf="teams[station.team]">
          <span *ngIf="station.team == myTeam"><i>Diese Station gehört deinem Team.</i></span>
          <span *ngIf="station.team != myTeam">
            Diese Station gehört {{teams[station.team].name}}<br>
          </span>
        </div>
        <div *ngIf="!teams[station.team]">
          Diese Station gehört noch keinem Team.
        </div>
        <br>
        <div *ngIf="userLocation && station.team != myTeam">
          <button ion-button full (click)="openCaptureModal(station)">Einnehmen</button>
        </div>
        <div *ngIf="!userLocation">
          <b>Kein Standort gefunden</b><br>
          Station kann nicht eingenommen werden.
        </div>
      </sebm-google-map-info-window>
    </sebm-google-map-marker>

    <!-- User Location Icon -->
    <sebm-google-map-marker
            *ngIf="userLocation"
            [latitude]="userLocation.lat"
            [longitude]="userLocation.lng"
            [iconUrl]="{
                url: '/assets/bluecircle.png',
                anchor: {x: 8, y: 8},
                size: {width: 16, height: 16},
                scaledSize: {width: 16, height: 16}
            }"
    >
    </sebm-google-map-marker>

    <!-- Mrx Icons -->
    <sebm-google-map-marker
            *ngFor="let mrx of mrxs"
            [latitude]="mrx.xpos_lat"
            [longitude]="mrx.xpos_long"
            [iconUrl]="{
                url: '/assets/mrx.png',
                anchor: {x: 13, y: 15},
                size: {width: 27, height: 30},
                scaledSize: {width: 27, height: 30}
            }"
    >
      <sebm-google-map-info-window [disableAutoPan]="true">
        <h3>{{mrx.name}}</h3>
        {{mrx.description}}
      </sebm-google-map-info-window>
    </sebm-google-map-marker>


    <!-- Riddles -->
    <span *ngFor="let riddle of riddles">
      <span *ngIf="riddle.pos_lat">

        <!-- Riddle Radius -->
        <sebm-google-map-circle
                [latitude]="riddle.pos_lat"
                [longitude]="riddle.pos_long"
                [radius]="100"
                [fillColor]="black"
                [fillOpacity]="0.1"
                [circleDraggable]="false"
                [editable]="false"
                [clickable]="false"
        >
        </sebm-google-map-circle>


        <!-- Riddle Icons -->
        <sebm-google-map-marker
                [latitude]="riddle.pos_lat"
                [longitude]="riddle.pos_long"
                [iconUrl]="{
                    path: fa.markers.QUESTION,
                    scale: 0.5,
                    anchor: {x: 20, y: -30},
                    strokeWeight: 2,
                    strokeColor: 'white',
                    strokeOpacity: 1,
                    fillColor: getRiddleStateColor(riddle.state),
                    fillOpacity: 1
                }"
        >
          <sebm-google-map-info-window [disableAutoPan]="true">
            <h3>Rätsel {{riddle.r_ID}}</h3>
            <div *ngIf="riddle.question">
              {{riddle.question}}
            </div>
            <div *ngIf="!riddle.question">
              <i>Frage versteckt. Das Rätsel kann nur vor Ort entsperrt werden.</i>
            </div>

          </sebm-google-map-info-window>
        </sebm-google-map-marker>
      </span>
    </span>
  </sebm-google-map>
</ion-content>
